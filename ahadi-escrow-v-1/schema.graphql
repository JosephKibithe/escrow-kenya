# We explicitly set immutable: false because deals change status (Locked -> Released)
type Deal @entity(immutable: false) {
  id: ID!
  buyer: User! # Changed from Bytes! to User! to allow relationship linking
  seller: User! # Changed from Bytes! to User! to allow relationship linking
  amount: BigInt!
  timeoutInSeconds: BigInt!
  createdAtTimestamp: BigInt!
  
  # Status Flags
  isCompleted: Boolean!
  isDisputed: Boolean!
  isRefunded: Boolean!
  
  # Transaction Hashes
  depositTx: Bytes!
  releaseTx: Bytes
  refundTx: Bytes
}

type User @entity(immutable: false) {
  id: ID! # Wallet Address
  dealsAsBuyer: [Deal!]! @derivedFrom(field: "buyer")
  dealsAsSeller: [Deal!]! @derivedFrom(field: "seller")
}
